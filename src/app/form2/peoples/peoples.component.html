<section class="peoples">
  <div class="container">
    <h4>Add Guest</h4>
    <form [formGroup]="personForm" (ngSubmit)="onSubmit()">
      <div formArrayName="persons">
        <div *ngFor="let person of personsArray.controls; let i = index" [formGroupName]="i">
          <div class="person_sec">
            <div class="row">
              <div class="col-md-8">
                <div class="addperson">
                  <label for="firstName{{i}}">First Name:</label>
                  <input type="text" id="firstName{{i}}" formControlName="firstName" class="form-control">
                  <div *ngIf="person.get('firstName')?.invalid && 
                              (person.get('firstName')?.dirty || 
                               person.get('firstName')?.touched)" class="text-danger">
                    First Name is required.
                  </div>

                  <label for="lastName{{i}}">Last Name:</label>
                  <input type="text" id="lastName{{i}}" formControlName="lastName" class="form-control">
                  <div *ngIf="person.get('lastName')?.invalid && 
                              (person.get('lastName')?.dirty || 
                               person.get('lastName')?.touched)" class="text-danger">
                    Last Name is required.
                  </div>

                  <label for="age{{i}}">Age:</label>
                  <input type="number" id="age{{i}}" formControlName="age" class="form-control" placeholder="Enter Age">
                  <div *ngIf="person.get('age')?.invalid && 
                              (person.get('age')?.dirty || 
                               person.get('age')?.touched)" class="text-danger">
                    Age is required and must be a positive number.
                  </div>

                  <label for="upload{{i}}">Upload documents</label>
                  <ngx-dropzone (change)="onSelect($event, i)" class="upload_docs" [multiple]="true">
                    <div class="upload">
                      <div>
                        <img class="upload_img" src="../../assets/images/drop.jpeg">
                      </div>
                      <div class="drop_img">
                        <h5 class="drop_input">Drag and drop files here</h5>
                      </div>
                    </div>
                    <ngx-dropzone-preview *ngFor="let file of person.get('documents')?.value" [file]="file" [removable]="true" (removed)="onRemove(file, i)">
                      <ngx-dropzone-label>{{ file.name }} ({{ file.type }})</ngx-dropzone-label>
                    </ngx-dropzone-preview>
                  </ngx-dropzone>
                  <div *ngIf="person.get('documents')?.hasError('fileRequired') && 
                              (person.get('documents')?.dirty || 
                               person.get('documents')?.touched)" class="text-danger">
                    At least one document is required.
                  </div>
                  <div *ngIf="person.get('documents')?.hasError('fileTypeInvalid') && 
                              (person.get('documents')?.dirty || 
                               person.get('documents')?.touched)" class="text-danger">
                    Documents must be of type JPG or PNG.
                  </div>
                  <div *ngIf="person.get('documents')?.hasError('fileSizeExceeded') && 
                              (person.get('documents')?.dirty || 
                               person.get('documents')?.touched)" class="text-danger">
                    Documents must not exceed 50 KB in size.
                  </div>
                </div>
              </div>

              <div class="col-md-4">
                <div class="button-group">
                  <div class="clear">
                    <button *ngIf="personsArray.length > 1" class="btn btn-secondary" type="button" (click)="removePerson(i)">
                      <i class="fa-solid fa-xmark"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="add">
        <button class="btn btn-succes" type="button" (click)="addPerson()">
          Add
        </button>
      </div>

      <div class="submit">
        <button class="btn btn-secondary" routerLink="/form2/date">Prev</button>
        <button class="btn btn-succes" [disabled]="personForm.invalid" type="submit">Next</button>
      </div>
    </form>
  </div>
</section>
